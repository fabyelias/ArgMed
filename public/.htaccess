# Habilitar rewrite
RewriteEngine On
RewriteBase /

# Redirigir www a no-www (o viceversa si prefieres)
RewriteCond %{HTTP_HOST} ^www\.argmed\.online [NC]
RewriteRule ^(.*)$ https://argmed.online/$1 [L,R=301]

# SPA fallback - redirigir todo a index.html
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.html [L]

# Headers de cache y seguridad
<IfModule mod_headers.c>
  # Headers de seguridad
  Header always set X-Content-Type-Options "nosniff"
  Header always set X-Frame-Options "SAMEORIGIN"
  Header always set X-XSS-Protection "1; mode=block"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
  Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"

  # Forzar HTTPS
  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"

  # NUNCA cachear index.html
  <FilesMatch "index\.html$">
    Header set Cache-Control "no-cache, no-store, must-revalidate, max-age=0"
    Header set Pragma "no-cache"
    Header set Expires "0"
  </FilesMatch>

  # Cachear assets con hash por 1 año
  <FilesMatch "\.(js|css)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>

  # Cachear imágenes y fuentes
  <FilesMatch "\.(jpg|jpeg|png|gif|webp|svg|woff|woff2|ttf|eot)$">
    Header set Cache-Control "public, max-age=604800"
  </FilesMatch>
</IfModule>

# Comprimir archivos
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>
